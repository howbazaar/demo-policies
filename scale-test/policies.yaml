policies:
- name: scale-0001
  description: Scale test policy 1 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0002
  description: Scale test policy 2 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0003
  description: Scale test policy 3 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: StorageEncrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0004
  description: Scale test policy 4 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0005
  description: Scale test policy 5 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0006
  description: Scale test policy 6 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0007
  description: Scale test policy 7 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0008
  description: Scale test policy 8 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0009
  description: Scale test policy 9 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0010
  description: Scale test policy 10 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0011
  description: Scale test policy 11 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0012
  description: Scale test policy 12 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0013
  description: Scale test policy 13 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0014
  description: Scale test policy 14 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0015
  description: Scale test policy 15 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - tag:Team: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0016
  description: Scale test policy 16 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0017
  description: Scale test policy 17 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0018
  description: Scale test policy 18 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0019
  description: Scale test policy 19 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0020
  description: Scale test policy 20 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0021
  description: Scale test policy 21 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0022
  description: Scale test policy 22 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0023
  description: Scale test policy 23 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0024
  description: Scale test policy 24 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0025
  description: Scale test policy 25 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0026
  description: Scale test policy 26 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0027
  description: Scale test policy 27 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0028
  description: Scale test policy 28 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0029
  description: Scale test policy 29 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0030
  description: Scale test policy 30 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0031
  description: Scale test policy 31 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0032
  description: Scale test policy 32 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0033
  description: Scale test policy 33 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0034
  description: Scale test policy 34 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: set-protection
    state: false
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0035
  description: Scale test policy 35 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0036
  description: Scale test policy 36 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0037
  description: Scale test policy 37 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0038
  description: Scale test policy 38 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0039
  description: Scale test policy 39 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - tag:Environment: absent
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0040
  description: Scale test policy 40 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: global-grants
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0041
  description: Scale test policy 41 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: StorageEncrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0042
  description: Scale test policy 42 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: security-group
    key: GroupName
    value: default
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0043
  description: Scale test policy 43 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0044
  description: Scale test policy 44 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - tag:SecurityReviewed: absent
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
  - type: auto-tag-user
    tag: ModifiedBy
- name: scale-0045
  description: Scale test policy 45 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0046
  description: Scale test policy 46 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0047
  description: Scale test policy 47 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0048
  description: Scale test policy 48 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0049
  description: Scale test policy 49 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0050
  description: Scale test policy 50 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  - tag:Purpose: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0051
  description: Scale test policy 51 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0052
  description: Scale test policy 52 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - tag:Owner: absent
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0053
  description: Scale test policy 53 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0054
  description: Scale test policy 54 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0055
  description: Scale test policy 55 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0056
  description: Scale test policy 56 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0057
  description: Scale test policy 57 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0058
  description: Scale test policy 58 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0059
  description: Scale test policy 59 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0060
  description: Scale test policy 60 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0061
  description: Scale test policy 61 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0062
  description: Scale test policy 62 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0063
  description: Scale test policy 63 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0064
  description: Scale test policy 64 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0065
  description: Scale test policy 65 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0066
  description: Scale test policy 66 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0067
  description: Scale test policy 67 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0068
  description: Scale test policy 68 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0069
  description: Scale test policy 69 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0070
  description: Scale test policy 70 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0071
  description: Scale test policy 71 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0072
  description: Scale test policy 72 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: set-protection
    state: false
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0073
  description: Scale test policy 73 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0074
  description: Scale test policy 74 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0075
  description: Scale test policy 75 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0076
  description: Scale test policy 76 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0077
  description: Scale test policy 77 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: value
    key: State.Name
    value: running
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0078
  description: Scale test policy 78 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: encryption-policy
  - type: auto-tag-user
    tag: Owner
- name: scale-0079
  description: Scale test policy 79 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: StorageEncrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0080
  description: Scale test policy 80 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - tag:Application: absent
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: security-group
    key: GroupName
    value: default
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0081
  description: Scale test policy 81 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0082
  description: Scale test policy 82 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - tag:SecurityReviewed: absent
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0083
  description: Scale test policy 83 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0084
  description: Scale test policy 84 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0085
  description: Scale test policy 85 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0086
  description: Scale test policy 86 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0087
  description: Scale test policy 87 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0088
  description: Scale test policy 88 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0089
  description: Scale test policy 89 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0090
  description: Scale test policy 90 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0091
  description: Scale test policy 91 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0092
  description: Scale test policy 92 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0093
  description: Scale test policy 93 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0094
  description: Scale test policy 94 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0095
  description: Scale test policy 95 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0096
  description: Scale test policy 96 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0097
  description: Scale test policy 97 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0098
  description: Scale test policy 98 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0099
  description: Scale test policy 99 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - tag:DataOwner: absent
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0100
  description: Scale test policy 100 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0101
  description: Scale test policy 101 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0102
  description: Scale test policy 102 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0103
  description: Scale test policy 103 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0104
  description: Scale test policy 104 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0105
  description: Scale test policy 105 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0106
  description: Scale test policy 106 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0107
  description: Scale test policy 107 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0108
  description: Scale test policy 108 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0109
  description: Scale test policy 109 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0110
  description: Scale test policy 110 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0111
  description: Scale test policy 111 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0112
  description: Scale test policy 112 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
- name: scale-0113
  description: Scale test policy 113 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0114
  description: Scale test policy 114 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0115
  description: Scale test policy 115 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0116
  description: Scale test policy 116 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
  - type: encryption-policy
- name: scale-0117
  description: Scale test policy 117 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0118
  description: Scale test policy 118 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - tag:Application: absent
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0119
  description: Scale test policy 119 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0120
  description: Scale test policy 120 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0121
  description: Scale test policy 121 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0122
  description: Scale test policy 122 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0123
  description: Scale test policy 123 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0124
  description: Scale test policy 124 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0125
  description: Scale test policy 125 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0126
  description: Scale test policy 126 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
- name: scale-0127
  description: Scale test policy 127 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: is-not-logging
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0128
  description: Scale test policy 128 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 45
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0129
  description: Scale test policy 129 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0130
  description: Scale test policy 130 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0131
  description: Scale test policy 131 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0132
  description: Scale test policy 132 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0133
  description: Scale test policy 133 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0134
  description: Scale test policy 134 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0135
  description: Scale test policy 135 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0136
  description: Scale test policy 136 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0137
  description: Scale test policy 137 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0138
  description: Scale test policy 138 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0139
  description: Scale test policy 139 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0140
  description: Scale test policy 140 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0141
  description: Scale test policy 141 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0142
  description: Scale test policy 142 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0143
  description: Scale test policy 143 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0144
  description: Scale test policy 144 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0145
  description: Scale test policy 145 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0146
  description: Scale test policy 146 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0147
  description: Scale test policy 147 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0148
  description: Scale test policy 148 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StackOwner
  - type: set-protection
    state: false
- name: scale-0149
  description: Scale test policy 149 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0150
  description: Scale test policy 150 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0151
  description: Scale test policy 151 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0152
  description: Scale test policy 152 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0153
  description: Scale test policy 153 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - tag:Environment: absent
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0154
  description: Scale test policy 154 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: global-grants
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: encryption-policy
- name: scale-0155
  description: Scale test policy 155 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0156
  description: Scale test policy 156 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0157
  description: Scale test policy 157 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0158
  description: Scale test policy 158 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: auto-tag-user
    tag: ModifiedBy
- name: scale-0159
  description: Scale test policy 159 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0160
  description: Scale test policy 160 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0161
  description: Scale test policy 161 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0162
  description: Scale test policy 162 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0163
  description: Scale test policy 163 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0164
  description: Scale test policy 164 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0165
  description: Scale test policy 165 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0166
  description: Scale test policy 166 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0167
  description: Scale test policy 167 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0168
  description: Scale test policy 168 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0169
  description: Scale test policy 169 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0170
  description: Scale test policy 170 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0171
  description: Scale test policy 171 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0172
  description: Scale test policy 172 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0173
  description: Scale test policy 173 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0174
  description: Scale test policy 174 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0175
  description: Scale test policy 175 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0176
  description: Scale test policy 176 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: StreamCreator
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0177
  description: Scale test policy 177 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0178
  description: Scale test policy 178 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0179
  description: Scale test policy 179 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0180
  description: Scale test policy 180 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0181
  description: Scale test policy 181 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0182
  description: Scale test policy 182 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0183
  description: Scale test policy 183 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0184
  description: Scale test policy 184 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0185
  description: Scale test policy 185 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0186
  description: Scale test policy 186 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0187
  description: Scale test policy 187 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0188
  description: Scale test policy 188 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0189
  description: Scale test policy 189 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0190
  description: Scale test policy 190 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0191
  description: Scale test policy 191 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0192
  description: Scale test policy 192 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0193
  description: Scale test policy 193 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: StorageEncrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0194
  description: Scale test policy 194 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: auto-tag-user
    tag: Creator
- name: scale-0195
  description: Scale test policy 195 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0196
  description: Scale test policy 196 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0197
  description: Scale test policy 197 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0198
  description: Scale test policy 198 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0199
  description: Scale test policy 199 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - tag:CostCenter: absent
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0200
  description: Scale test policy 200 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0201
  description: Scale test policy 201 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0202
  description: Scale test policy 202 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0203
  description: Scale test policy 203 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: is-not-logging
  - tag:Application: absent
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0204
  description: Scale test policy 204 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0205
  description: Scale test policy 205 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0206
  description: Scale test policy 206 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  - type: value
    key: Public
    value: true
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0207
  description: Scale test policy 207 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0208
  description: Scale test policy 208 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0209
  description: Scale test policy 209 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0210
  description: Scale test policy 210 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0211
  description: Scale test policy 211 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0212
  description: Scale test policy 212 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0213
  description: Scale test policy 213 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - tag:DataOwner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0214
  description: Scale test policy 214 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0215
  description: Scale test policy 215 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0216
  description: Scale test policy 216 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0217
  description: Scale test policy 217 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0218
  description: Scale test policy 218 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0219
  description: Scale test policy 219 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0220
  description: Scale test policy 220 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0221
  description: Scale test policy 221 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0222
  description: Scale test policy 222 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0223
  description: Scale test policy 223 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0224
  description: Scale test policy 224 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0225
  description: Scale test policy 225 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0226
  description: Scale test policy 226 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
- name: scale-0227
  description: Scale test policy 227 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0228
  description: Scale test policy 228 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0229
  description: Scale test policy 229 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0230
  description: Scale test policy 230 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: global-grants
  - tag:Owner: absent
  - type: no-encryption-statement
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0231
  description: Scale test policy 231 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0232
  description: Scale test policy 232 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0233
  description: Scale test policy 233 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0234
  description: Scale test policy 234 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0235
  description: Scale test policy 235 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0236
  description: Scale test policy 236 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0237
  description: Scale test policy 237 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: Creator
- name: scale-0238
  description: Scale test policy 238 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0239
  description: Scale test policy 239 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0240
  description: Scale test policy 240 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
- name: scale-0241
  description: Scale test policy 241 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0242
  description: Scale test policy 242 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0243
  description: Scale test policy 243 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0244
  description: Scale test policy 244 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - tag:Version: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0245
  description: Scale test policy 245 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0246
  description: Scale test policy 246 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0247
  description: Scale test policy 247 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0248
  description: Scale test policy 248 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0249
  description: Scale test policy 249 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0250
  description: Scale test policy 250 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0251
  description: Scale test policy 251 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0252
  description: Scale test policy 252 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0253
  description: Scale test policy 253 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - tag:Owner: absent
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0254
  description: Scale test policy 254 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0255
  description: Scale test policy 255 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0256
  description: Scale test policy 256 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0257
  description: Scale test policy 257 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0258
  description: Scale test policy 258 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0259
  description: Scale test policy 259 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0260
  description: Scale test policy 260 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0261
  description: Scale test policy 261 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0262
  description: Scale test policy 262 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0263
  description: Scale test policy 263 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0264
  description: Scale test policy 264 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0265
  description: Scale test policy 265 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0266
  description: Scale test policy 266 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0267
  description: Scale test policy 267 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - tag:Environment: absent
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0268
  description: Scale test policy 268 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: global-grants
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
- name: scale-0269
  description: Scale test policy 269 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0270
  description: Scale test policy 270 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: auto-tag-user
    tag: Creator
- name: scale-0271
  description: Scale test policy 271 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0272
  description: Scale test policy 272 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - tag:SecurityReviewed: absent
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0273
  description: Scale test policy 273 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0274
  description: Scale test policy 274 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0275
  description: Scale test policy 275 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0276
  description: Scale test policy 276 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0277
  description: Scale test policy 277 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0278
  description: Scale test policy 278 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  - tag:Purpose: absent
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
- name: scale-0279
  description: Scale test policy 279 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: is-not-logging
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0280
  description: Scale test policy 280 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0281
  description: Scale test policy 281 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  - type: not-encrypted
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0282
  description: Scale test policy 282 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0283
  description: Scale test policy 283 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0284
  description: Scale test policy 284 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0285
  description: Scale test policy 285 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0286
  description: Scale test policy 286 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0287
  description: Scale test policy 287 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0288
  description: Scale test policy 288 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0289
  description: Scale test policy 289 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0290
  description: Scale test policy 290 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: StreamCreator
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0291
  description: Scale test policy 291 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0292
  description: Scale test policy 292 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0293
  description: Scale test policy 293 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0294
  description: Scale test policy 294 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0295
  description: Scale test policy 295 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0296
  description: Scale test policy 296 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0297
  description: Scale test policy 297 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0298
  description: Scale test policy 298 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0299
  description: Scale test policy 299 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0300
  description: Scale test policy 300 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0301
  description: Scale test policy 301 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0302
  description: Scale test policy 302 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0303
  description: Scale test policy 303 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0304
  description: Scale test policy 304 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0305
  description: Scale test policy 305 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - tag:Environment: absent
  - type: value
    key: State.Name
    value: running
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0306
  description: Scale test policy 306 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: no-encryption-statement
  - type: global-grants
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0307
  description: Scale test policy 307 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: StorageEncrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0308
  description: Scale test policy 308 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0309
  description: Scale test policy 309 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0310
  description: Scale test policy 310 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0311
  description: Scale test policy 311 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0312
  description: Scale test policy 312 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0313
  description: Scale test policy 313 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0314
  description: Scale test policy 314 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0315
  description: Scale test policy 315 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0316
  description: Scale test policy 316 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0317
  description: Scale test policy 317 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0318
  description: Scale test policy 318 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0319
  description: Scale test policy 319 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0320
  description: Scale test policy 320 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0321
  description: Scale test policy 321 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0322
  description: Scale test policy 322 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0323
  description: Scale test policy 323 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0324
  description: Scale test policy 324 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0325
  description: Scale test policy 325 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0326
  description: Scale test policy 326 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0327
  description: Scale test policy 327 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0328
  description: Scale test policy 328 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0329
  description: Scale test policy 329 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - tag:Owner: absent
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0330
  description: Scale test policy 330 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0331
  description: Scale test policy 331 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0332
  description: Scale test policy 332 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0333
  description: Scale test policy 333 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0334
  description: Scale test policy 334 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0335
  description: Scale test policy 335 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0336
  description: Scale test policy 336 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0337
  description: Scale test policy 337 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0338
  description: Scale test policy 338 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: set-protection
    state: false
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0339
  description: Scale test policy 339 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0340
  description: Scale test policy 340 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0341
  description: Scale test policy 341 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0342
  description: Scale test policy 342 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0343
  description: Scale test policy 343 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  - tag:Environment: absent
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0344
  description: Scale test policy 344 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - type: no-encryption-statement
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0345
  description: Scale test policy 345 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: StorageEncrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0346
  description: Scale test policy 346 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: auto-tag-user
    tag: Creator
- name: scale-0347
  description: Scale test policy 347 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0348
  description: Scale test policy 348 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0349
  description: Scale test policy 349 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0350
  description: Scale test policy 350 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0351
  description: Scale test policy 351 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0352
  description: Scale test policy 352 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0353
  description: Scale test policy 353 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0354
  description: Scale test policy 354 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
- name: scale-0355
  description: Scale test policy 355 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0356
  description: Scale test policy 356 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Owner: absent
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0357
  description: Scale test policy 357 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0358
  description: Scale test policy 358 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0359
  description: Scale test policy 359 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0360
  description: Scale test policy 360 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0361
  description: Scale test policy 361 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0362
  description: Scale test policy 362 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0363
  description: Scale test policy 363 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0364
  description: Scale test policy 364 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0365
  description: Scale test policy 365 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0366
  description: Scale test policy 366 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0367
  description: Scale test policy 367 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0368
  description: Scale test policy 368 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0369
  description: Scale test policy 369 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0370
  description: Scale test policy 370 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0371
  description: Scale test policy 371 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0372
  description: Scale test policy 372 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0373
  description: Scale test policy 373 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0374
  description: Scale test policy 374 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0375
  description: Scale test policy 375 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0376
  description: Scale test policy 376 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0377
  description: Scale test policy 377 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0378
  description: Scale test policy 378 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0379
  description: Scale test policy 379 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0380
  description: Scale test policy 380 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0381
  description: Scale test policy 381 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - tag:Environment: absent
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: ebs
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0382
  description: Scale test policy 382 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: global-grants
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0383
  description: Scale test policy 383 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0384
  description: Scale test policy 384 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - tag:Application: absent
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: auto-tag-user
    tag: Creator
- name: scale-0385
  description: Scale test policy 385 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0386
  description: Scale test policy 386 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0387
  description: Scale test policy 387 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0388
  description: Scale test policy 388 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0389
  description: Scale test policy 389 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0390
  description: Scale test policy 390 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0391
  description: Scale test policy 391 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0392
  description: Scale test policy 392 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0393
  description: Scale test policy 393 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0394
  description: Scale test policy 394 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0395
  description: Scale test policy 395 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0396
  description: Scale test policy 396 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0397
  description: Scale test policy 397 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0398
  description: Scale test policy 398 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0399
  description: Scale test policy 399 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0400
  description: Scale test policy 400 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0401
  description: Scale test policy 401 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0402
  description: Scale test policy 402 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0403
  description: Scale test policy 403 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0404
  description: Scale test policy 404 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0405
  description: Scale test policy 405 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0406
  description: Scale test policy 406 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0407
  description: Scale test policy 407 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0408
  description: Scale test policy 408 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0409
  description: Scale test policy 409 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0410
  description: Scale test policy 410 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0411
  description: Scale test policy 411 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0412
  description: Scale test policy 412 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0413
  description: Scale test policy 413 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0414
  description: Scale test policy 414 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0415
  description: Scale test policy 415 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0416
  description: Scale test policy 416 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0417
  description: Scale test policy 417 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0418
  description: Scale test policy 418 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0419
  description: Scale test policy 419 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  - type: value
    key: State.Name
    value: running
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0420
  description: Scale test policy 420 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: global-grants
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0421
  description: Scale test policy 421 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0422
  description: Scale test policy 422 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: security-group
    key: GroupName
    value: default
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0423
  description: Scale test policy 423 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0424
  description: Scale test policy 424 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0425
  description: Scale test policy 425 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0426
  description: Scale test policy 426 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0427
  description: Scale test policy 427 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0428
  description: Scale test policy 428 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0429
  description: Scale test policy 429 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0430
  description: Scale test policy 430 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  - tag:Purpose: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0431
  description: Scale test policy 431 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Application: absent
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0432
  description: Scale test policy 432 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - tag:Owner: absent
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0433
  description: Scale test policy 433 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0434
  description: Scale test policy 434 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0435
  description: Scale test policy 435 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0436
  description: Scale test policy 436 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0437
  description: Scale test policy 437 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0438
  description: Scale test policy 438 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0439
  description: Scale test policy 439 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0440
  description: Scale test policy 440 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0441
  description: Scale test policy 441 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0442
  description: Scale test policy 442 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0443
  description: Scale test policy 443 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0444
  description: Scale test policy 444 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0445
  description: Scale test policy 445 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0446
  description: Scale test policy 446 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0447
  description: Scale test policy 447 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0448
  description: Scale test policy 448 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0449
  description: Scale test policy 449 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0450
  description: Scale test policy 450 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0451
  description: Scale test policy 451 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0452
  description: Scale test policy 452 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StackOwner
  - type: set-protection
    state: false
- name: scale-0453
  description: Scale test policy 453 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0454
  description: Scale test policy 454 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: ComputeOwner
- name: scale-0455
  description: Scale test policy 455 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0456
  description: Scale test policy 456 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0457
  description: Scale test policy 457 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - tag:Environment: absent
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0458
  description: Scale test policy 458 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: global-grants
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0459
  description: Scale test policy 459 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0460
  description: Scale test policy 460 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0461
  description: Scale test policy 461 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0462
  description: Scale test policy 462 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0463
  description: Scale test policy 463 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0464
  description: Scale test policy 464 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0465
  description: Scale test policy 465 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0466
  description: Scale test policy 466 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0467
  description: Scale test policy 467 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0468
  description: Scale test policy 468 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0469
  description: Scale test policy 469 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0470
  description: Scale test policy 470 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  - tag:Owner: absent
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0471
  description: Scale test policy 471 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0472
  description: Scale test policy 472 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - tag:Version: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0473
  description: Scale test policy 473 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0474
  description: Scale test policy 474 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0475
  description: Scale test policy 475 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: grant-count
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0476
  description: Scale test policy 476 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0477
  description: Scale test policy 477 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: tag
    key: AccessReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0478
  description: Scale test policy 478 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0479
  description: Scale test policy 479 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0480
  description: Scale test policy 480 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0481
  description: Scale test policy 481 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0482
  description: Scale test policy 482 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0483
  description: Scale test policy 483 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0484
  description: Scale test policy 484 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0485
  description: Scale test policy 485 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0486
  description: Scale test policy 486 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0487
  description: Scale test policy 487 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0488
  description: Scale test policy 488 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0489
  description: Scale test policy 489 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0490
  description: Scale test policy 490 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0491
  description: Scale test policy 491 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0492
  description: Scale test policy 492 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: ComputeOwner
- name: scale-0493
  description: Scale test policy 493 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0494
  description: Scale test policy 494 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0495
  description: Scale test policy 495 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0496
  description: Scale test policy 496 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  - type: global-grants
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0497
  description: Scale test policy 497 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0498
  description: Scale test policy 498 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0499
  description: Scale test policy 499 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0500
  description: Scale test policy 500 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0501
  description: Scale test policy 501 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0502
  description: Scale test policy 502 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0503
  description: Scale test policy 503 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: auto-tag-user
    tag: Creator
- name: scale-0504
  description: Scale test policy 504 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0505
  description: Scale test policy 505 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0506
  description: Scale test policy 506 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0507
  description: Scale test policy 507 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0508
  description: Scale test policy 508 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0509
  description: Scale test policy 509 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0510
  description: Scale test policy 510 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - tag:Version: absent
  - type: value
    key: Public
    value: true
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0511
  description: Scale test policy 511 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0512
  description: Scale test policy 512 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0513
  description: Scale test policy 513 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0514
  description: Scale test policy 514 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0515
  description: Scale test policy 515 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0516
  description: Scale test policy 516 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0517
  description: Scale test policy 517 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0518
  description: Scale test policy 518 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0519
  description: Scale test policy 519 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0520
  description: Scale test policy 520 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0521
  description: Scale test policy 521 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0522
  description: Scale test policy 522 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0523
  description: Scale test policy 523 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0524
  description: Scale test policy 524 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0525
  description: Scale test policy 525 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0526
  description: Scale test policy 526 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0527
  description: Scale test policy 527 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0528
  description: Scale test policy 528 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0529
  description: Scale test policy 529 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0530
  description: Scale test policy 530 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0531
  description: Scale test policy 531 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0532
  description: Scale test policy 532 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0533
  description: Scale test policy 533 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - tag:Environment: absent
  - type: value
    key: State.Name
    value: running
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: ebs
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0534
  description: Scale test policy 534 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - tag:Owner: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0535
  description: Scale test policy 535 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: StorageEncrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0536
  description: Scale test policy 536 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0537
  description: Scale test policy 537 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0538
  description: Scale test policy 538 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0539
  description: Scale test policy 539 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0540
  description: Scale test policy 540 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: has-inline-policy
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0541
  description: Scale test policy 541 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0542
  description: Scale test policy 542 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0543
  description: Scale test policy 543 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0544
  description: Scale test policy 544 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  - tag:Purpose: absent
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0545
  description: Scale test policy 545 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0546
  description: Scale test policy 546 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: is-not-logging
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 45
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0547
  description: Scale test policy 547 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0548
  description: Scale test policy 548 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  - type: value
    key: Public
    value: true
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0549
  description: Scale test policy 549 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0550
  description: Scale test policy 550 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0551
  description: Scale test policy 551 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0552
  description: Scale test policy 552 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0553
  description: Scale test policy 553 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0554
  description: Scale test policy 554 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0555
  description: Scale test policy 555 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0556
  description: Scale test policy 556 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0557
  description: Scale test policy 557 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0558
  description: Scale test policy 558 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0559
  description: Scale test policy 559 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0560
  description: Scale test policy 560 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0561
  description: Scale test policy 561 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0562
  description: Scale test policy 562 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0563
  description: Scale test policy 563 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0564
  description: Scale test policy 564 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0565
  description: Scale test policy 565 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0566
  description: Scale test policy 566 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0567
  description: Scale test policy 567 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0568
  description: Scale test policy 568 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0569
  description: Scale test policy 569 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0570
  description: Scale test policy 570 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0571
  description: Scale test policy 571 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - tag:Environment: absent
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0572
  description: Scale test policy 572 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0573
  description: Scale test policy 573 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: StorageEncrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0574
  description: Scale test policy 574 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
  - type: auto-tag-user
    tag: Creator
- name: scale-0575
  description: Scale test policy 575 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0576
  description: Scale test policy 576 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0577
  description: Scale test policy 577 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0578
  description: Scale test policy 578 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0579
  description: Scale test policy 579 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: State
    value: available
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: Creator
- name: scale-0580
  description: Scale test policy 580 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0581
  description: Scale test policy 581 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0582
  description: Scale test policy 582 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0583
  description: Scale test policy 583 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0584
  description: Scale test policy 584 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0585
  description: Scale test policy 585 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0586
  description: Scale test policy 586 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: auto-tag-user
    tag: ImageCreator
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0587
  description: Scale test policy 587 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0588
  description: Scale test policy 588 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0589
  description: Scale test policy 589 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0590
  description: Scale test policy 590 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0591
  description: Scale test policy 591 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0592
  description: Scale test policy 592 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: cross-account
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0593
  description: Scale test policy 593 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0594
  description: Scale test policy 594 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0595
  description: Scale test policy 595 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0596
  description: Scale test policy 596 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0597
  description: Scale test policy 597 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0598
  description: Scale test policy 598 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0599
  description: Scale test policy 599 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0600
  description: Scale test policy 600 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0601
  description: Scale test policy 601 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0602
  description: Scale test policy 602 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0603
  description: Scale test policy 603 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0604
  description: Scale test policy 604 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0605
  description: Scale test policy 605 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0606
  description: Scale test policy 606 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0607
  description: Scale test policy 607 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0608
  description: Scale test policy 608 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0609
  description: Scale test policy 609 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0610
  description: Scale test policy 610 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: global-grants
  actions:
  - type: encryption-policy
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0611
  description: Scale test policy 611 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0612
  description: Scale test policy 612 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0613
  description: Scale test policy 613 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0614
  description: Scale test policy 614 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0615
  description: Scale test policy 615 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0616
  description: Scale test policy 616 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0617
  description: Scale test policy 617 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0618
  description: Scale test policy 618 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0619
  description: Scale test policy 619 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0620
  description: Scale test policy 620 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0621
  description: Scale test policy 621 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0622
  description: Scale test policy 622 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0623
  description: Scale test policy 623 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: not-encrypted
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0624
  description: Scale test policy 624 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - type: value
    key: State
    value: available
  - tag:Version: absent
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0625
  description: Scale test policy 625 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0626
  description: Scale test policy 626 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0627
  description: Scale test policy 627 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0628
  description: Scale test policy 628 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0629
  description: Scale test policy 629 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0630
  description: Scale test policy 630 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0631
  description: Scale test policy 631 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0632
  description: Scale test policy 632 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0633
  description: Scale test policy 633 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0634
  description: Scale test policy 634 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0635
  description: Scale test policy 635 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0636
  description: Scale test policy 636 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0637
  description: Scale test policy 637 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0638
  description: Scale test policy 638 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0639
  description: Scale test policy 639 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0640
  description: Scale test policy 640 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0641
  description: Scale test policy 641 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0642
  description: Scale test policy 642 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0643
  description: Scale test policy 643 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0644
  description: Scale test policy 644 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0645
  description: Scale test policy 645 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0646
  description: Scale test policy 646 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0647
  description: Scale test policy 647 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: State.Name
    value: running
  - tag:Environment: absent
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0648
  description: Scale test policy 648 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  - type: no-encryption-statement
  - type: global-grants
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0649
  description: Scale test policy 649 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0650
  description: Scale test policy 650 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0651
  description: Scale test policy 651 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0652
  description: Scale test policy 652 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0653
  description: Scale test policy 653 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0654
  description: Scale test policy 654 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0655
  description: Scale test policy 655 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0656
  description: Scale test policy 656 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0657
  description: Scale test policy 657 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0658
  description: Scale test policy 658 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
- name: scale-0659
  description: Scale test policy 659 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0660
  description: Scale test policy 660 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0661
  description: Scale test policy 661 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0662
  description: Scale test policy 662 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - tag:Version: absent
  - type: value
    key: Public
    value: true
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0663
  description: Scale test policy 663 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0664
  description: Scale test policy 664 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0665
  description: Scale test policy 665 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0666
  description: Scale test policy 666 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0667
  description: Scale test policy 667 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0668
  description: Scale test policy 668 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0669
  description: Scale test policy 669 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0670
  description: Scale test policy 670 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0671
  description: Scale test policy 671 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0672
  description: Scale test policy 672 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0673
  description: Scale test policy 673 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0674
  description: Scale test policy 674 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0675
  description: Scale test policy 675 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0676
  description: Scale test policy 676 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0677
  description: Scale test policy 677 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0678
  description: Scale test policy 678 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0679
  description: Scale test policy 679 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0680
  description: Scale test policy 680 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0681
  description: Scale test policy 681 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:DataTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0682
  description: Scale test policy 682 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0683
  description: Scale test policy 683 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0684
  description: Scale test policy 684 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0685
  description: Scale test policy 685 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
- name: scale-0686
  description: Scale test policy 686 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: global-grants
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0687
  description: Scale test policy 687 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0688
  description: Scale test policy 688 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  - type: security-group
    key: GroupName
    value: default
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0689
  description: Scale test policy 689 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0690
  description: Scale test policy 690 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0691
  description: Scale test policy 691 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0692
  description: Scale test policy 692 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0693
  description: Scale test policy 693 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0694
  description: Scale test policy 694 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0695
  description: Scale test policy 695 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0696
  description: Scale test policy 696 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0697
  description: Scale test policy 697 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0698
  description: Scale test policy 698 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0699
  description: Scale test policy 699 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - tag:Team: absent
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0700
  description: Scale test policy 700 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - tag:Version: absent
  - type: value
    key: Public
    value: true
  - type: value
    key: State
    value: available
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0701
  description: Scale test policy 701 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0702
  description: Scale test policy 702 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0703
  description: Scale test policy 703 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0704
  description: Scale test policy 704 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0705
  description: Scale test policy 705 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0706
  description: Scale test policy 706 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: cross-account
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionReview
    value: Required
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0707
  description: Scale test policy 707 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - type: value
    key: StreamStatus
    value: ACTIVE
  - tag:DataOwner: absent
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0708
  description: Scale test policy 708 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0709
  description: Scale test policy 709 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0710
  description: Scale test policy 710 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0711
  description: Scale test policy 711 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0712
  description: Scale test policy 712 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0713
  description: Scale test policy 713 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0714
  description: Scale test policy 714 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0715
  description: Scale test policy 715 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0716
  description: Scale test policy 716 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0717
  description: Scale test policy 717 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0718
  description: Scale test policy 718 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0719
  description: Scale test policy 719 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0720
  description: Scale test policy 720 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0721
  description: Scale test policy 721 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0722
  description: Scale test policy 722 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - tag:Team: absent
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0723
  description: Scale test policy 723 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0724
  description: Scale test policy 724 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: global-grants
  - tag:Owner: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0725
  description: Scale test policy 725 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0726
  description: Scale test policy 726 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0727
  description: Scale test policy 727 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0728
  description: Scale test policy 728 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0729
  description: Scale test policy 729 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0730
  description: Scale test policy 730 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0731
  description: Scale test policy 731 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  - tag:CostCenter: absent
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: Creator
- name: scale-0732
  description: Scale test policy 732 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0733
  description: Scale test policy 733 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0734
  description: Scale test policy 734 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0735
  description: Scale test policy 735 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0736
  description: Scale test policy 736 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  actions:
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0737
  description: Scale test policy 737 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0738
  description: Scale test policy 738 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: auto-tag-user
    tag: ImageCreator
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0739
  description: Scale test policy 739 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0740
  description: Scale test policy 740 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: LogFileValidationEnabled
    value: false
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: auto-tag-user
    tag: TrailCreator
  - type: tag
    key: ValidationRequired
    value: 'true'
- name: scale-0741
  description: Scale test policy 741 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0742
  description: Scale test policy 742 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0743
  description: Scale test policy 743 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - tag:Application: absent
  - type: value
    key: DisplayName
    value: absent
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0744
  description: Scale test policy 744 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: QueueCreator
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0745
  description: Scale test policy 745 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: mark-for-op
    op: delete
    days: 120
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0746
  description: Scale test policy 746 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0747
  description: Scale test policy 747 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0748
  description: Scale test policy 748 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0749
  description: Scale test policy 749 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0750
  description: Scale test policy 750 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0751
  description: Scale test policy 751 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0752
  description: Scale test policy 752 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0753
  description: Scale test policy 753 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0754
  description: Scale test policy 754 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0755
  description: Scale test policy 755 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0756
  description: Scale test policy 756 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: set-protection
    state: false
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0757
  description: Scale test policy 757 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0758
  description: Scale test policy 758 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0759
  description: Scale test policy 759 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0760
  description: Scale test policy 760 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0761
  description: Scale test policy 761 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0762
  description: Scale test policy 762 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: no-encryption-statement
  - tag:Owner: absent
  - type: global-grants
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0763
  description: Scale test policy 763 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0764
  description: Scale test policy 764 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: security-group
    key: GroupName
    value: default
  - tag:Application: absent
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0765
  description: Scale test policy 765 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - type: value
    key: SSEDescription.Status
    value: absent
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0766
  description: Scale test policy 766 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - tag:SecurityReviewed: absent
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: auto-tag-user
    tag: ModifiedBy
- name: scale-0767
  description: Scale test policy 767 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0768
  description: Scale test policy 768 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0769
  description: Scale test policy 769 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0770
  description: Scale test policy 770 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0771
  description: Scale test policy 771 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: FlowLogsRequired
    value: 'true'
- name: scale-0772
  description: Scale test policy 772 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0773
  description: Scale test policy 773 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0774
  description: Scale test policy 774 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - type: value
    key: Scheme
    value: internet-facing
  - tag:Owner: absent
  - type: is-not-logging
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: auto-tag-user
    tag: ALBCreator
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0775
  description: Scale test policy 775 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0776
  description: Scale test policy 776 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - type: value
    key: State
    value: available
  - tag:Version: absent
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0777
  description: Scale test policy 777 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0778
  description: Scale test policy 778 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - tag:SecurityTeam: absent
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0779
  description: Scale test policy 779 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: grant-count
  - tag:KeyManager: absent
  actions:
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
- name: scale-0780
  description: Scale test policy 780 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyState
    value: Enabled
  - tag:DataClassification: absent
  - type: cross-account
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0781
  description: Scale test policy 781 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0782
  description: Scale test policy 782 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0783
  description: Scale test policy 783 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0784
  description: Scale test policy 784 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0785
  description: Scale test policy 785 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0786
  description: Scale test policy 786 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0787
  description: Scale test policy 787 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0788
  description: Scale test policy 788 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0789
  description: Scale test policy 789 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0790
  description: Scale test policy 790 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0791
  description: Scale test policy 791 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: RepositoryOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0792
  description: Scale test policy 792 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0793
  description: Scale test policy 793 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0794
  description: Scale test policy 794 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: set-protection
    state: false
- name: scale-0795
  description: Scale test policy 795 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0796
  description: Scale test policy 796 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0797
  description: Scale test policy 797 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0798
  description: Scale test policy 798 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
- name: scale-0799
  description: Scale test policy 799 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: value
    key: State.Name
    value: running
  - tag:Environment: absent
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0800
  description: Scale test policy 800 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: global-grants
  - type: no-encryption-statement
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: encryption-policy
  - type: auto-tag-user
    tag: Owner
- name: scale-0801
  description: Scale test policy 801 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0802
  description: Scale test policy 802 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: value
    key: Timeout
    value: 300
    op: gt
  - tag:Application: absent
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: auto-tag-user
    tag: Creator
- name: scale-0803
  description: Scale test policy 803 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0804
  description: Scale test policy 804 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - tag:SecurityReviewed: absent
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0805
  description: Scale test policy 805 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0806
  description: Scale test policy 806 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0807
  description: Scale test policy 807 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: State
    value: available
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: Creator
- name: scale-0808
  description: Scale test policy 808 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: SnapshotOwner
- name: scale-0809
  description: Scale test policy 809 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - tag:NetworkTeam: absent
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0810
  description: Scale test policy 810 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - tag:Purpose: absent
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0811
  description: Scale test policy 811 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - tag:Application: absent
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0812
  description: Scale test policy 812 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: is-not-logging
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: auto-tag-user
    tag: ALBCreator
- name: scale-0813
  description: Scale test policy 813 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0814
  description: Scale test policy 814 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0815
  description: Scale test policy 815 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0816
  description: Scale test policy 816 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0817
  description: Scale test policy 817 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0818
  description: Scale test policy 818 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  - type: cross-account
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0819
  description: Scale test policy 819 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: AccessReview
    value: Required
- name: scale-0820
  description: Scale test policy 820 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0821
  description: Scale test policy 821 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0822
  description: Scale test policy 822 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0823
  description: Scale test policy 823 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0824
  description: Scale test policy 824 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0825
  description: Scale test policy 825 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0826
  description: Scale test policy 826 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0827
  description: Scale test policy 827 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0828
  description: Scale test policy 828 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0829
  description: Scale test policy 829 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0830
  description: Scale test policy 830 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - type: value
    key: environment.privilegedMode
    value: true
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0831
  description: Scale test policy 831 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0832
  description: Scale test policy 832 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
- name: scale-0833
  description: Scale test policy 833 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0834
  description: Scale test policy 834 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
- name: scale-0835
  description: Scale test policy 835 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0836
  description: Scale test policy 836 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0837
  description: Scale test policy 837 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - tag:Environment: absent
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
- name: scale-0838
  description: Scale test policy 838 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - type: global-grants
  - tag:Owner: absent
  - type: no-encryption-statement
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
  - type: encryption-policy
- name: scale-0839
  description: Scale test policy 839 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: CreatedBy
- name: scale-0840
  description: Scale test policy 840 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - tag:Application: absent
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 21
  - type: tag
    key: RuntimeUpgrade
    value: Required
- name: scale-0841
  description: Scale test policy 841 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - tag:DataClassification: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0842
  description: Scale test policy 842 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: auto-tag-user
    tag: ModifiedBy
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0843
  description: Scale test policy 843 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0844
  description: Scale test policy 844 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0845
  description: Scale test policy 845 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0846
  description: Scale test policy 846 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0847
  description: Scale test policy 847 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0848
  description: Scale test policy 848 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0849
  description: Scale test policy 849 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0850
  description: Scale test policy 850 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0851
  description: Scale test policy 851 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0852
  description: Scale test policy 852 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  actions:
  - type: mark-for-op
    op: deregister
    days: 180
  - type: auto-tag-user
    tag: ImageCreator
- name: scale-0853
  description: Scale test policy 853 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: KeyOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0854
  description: Scale test policy 854 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0855
  description: Scale test policy 855 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - tag:KeyManager: absent
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0856
  description: Scale test policy 856 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0857
  description: Scale test policy 857 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0858
  description: Scale test policy 858 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - tag:Owner: absent
  - type: cross-account
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0859
  description: Scale test policy 859 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0860
  description: Scale test policy 860 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamCreator
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0861
  description: Scale test policy 861 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: CacheOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0862
  description: Scale test policy 862 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0863
  description: Scale test policy 863 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: DomainOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0864
  description: Scale test policy 864 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0865
  description: Scale test policy 865 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: tag
    key: ExpirationAlert
    value: Required
  - type: auto-tag-user
    tag: CertificateRequester
- name: scale-0866
  description: Scale test policy 866 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0867
  description: Scale test policy 867 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0868
  description: Scale test policy 868 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0869
  description: Scale test policy 869 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: PipelineOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0870
  description: Scale test policy 870 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0871
  description: Scale test policy 871 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0872
  description: Scale test policy 872 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0873
  description: Scale test policy 873 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - type: value
    key: networkMode
    value: host
  - tag:Application: absent
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0874
  description: Scale test policy 874 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0875
  description: Scale test policy 875 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - tag:Environment: absent
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
- name: scale-0876
  description: Scale test policy 876 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - tag:Owner: absent
  - type: global-grants
  - type: no-encryption-statement
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
  - type: encryption-policy
- name: scale-0877
  description: Scale test policy 877 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0878
  description: Scale test policy 878 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - tag:Application: absent
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0879
  description: Scale test policy 879 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0880
  description: Scale test policy 880 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0881
  description: Scale test policy 881 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: credential
    key: mfa_active
    value: false
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0882
  description: Scale test policy 882 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: has-inline-policy
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0883
  description: Scale test policy 883 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0884
  description: Scale test policy 884 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0885
  description: Scale test policy 885 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  actions:
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0886
  description: Scale test policy 886 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0887
  description: Scale test policy 887 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  - type: ssl-policy
    whitelist:
    - Protocol-TLSv1.2
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0888
  description: Scale test policy 888 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: listener
    key: Protocol
    value: HTTP
  - tag:Owner: absent
  - type: is-not-logging
  - type: value
    key: Scheme
    value: internet-facing
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: mark-for-op
    op: delete
    days: 45
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0889
  description: Scale test policy 889 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  - type: not-encrypted
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0890
  description: Scale test policy 890 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - tag:Version: absent
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  actions:
  - type: tag
    key: PublicAMIWarning
    value: 'true'
  - type: mark-for-op
    op: deregister
    days: 180
- name: scale-0891
  description: Scale test policy 891 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0892
  description: Scale test policy 892 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  - type: value
    key: IsMultiRegionTrail
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0893
  description: Scale test policy 893 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: grant-count
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0894
  description: Scale test policy 894 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0895
  description: Scale test policy 895 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: cross-account
  - type: value
    key: DisplayName
    value: absent
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0896
  description: Scale test policy 896 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: QueueCreator
- name: scale-0897
  description: Scale test policy 897 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - type: value
    key: StreamStatus
    value: ACTIVE
  - type: value
    key: EncryptionType
    value: NONE
  - tag:DataOwner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: StreamOwner
- name: scale-0898
  description: Scale test policy 898 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0899
  description: Scale test policy 899 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  - type: value
    key: TransitEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: CacheOwner
- name: scale-0900
  description: Scale test policy 900 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0901
  description: Scale test policy 901 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  - tag:Application: absent
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: DomainOwner
- name: scale-0902
  description: Scale test policy 902 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - type: value
    key: LifeCycleState
    value: available
  - type: value
    key: Encrypted
    value: false
  - tag:Owner: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: FileSystemOwner
- name: scale-0903
  description: Scale test policy 903 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0904
  description: Scale test policy 904 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0905
  description: Scale test policy 905 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0906
  description: Scale test policy 906 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0907
  description: Scale test policy 907 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - type: value
    key: name
    op: glob
    value: dev-*
  - tag:Application: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: PipelineOwner
- name: scale-0908
  description: Scale test policy 908 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: set-protection
    state: false
- name: scale-0909
  description: Scale test policy 909 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ConnectionOwner
- name: scale-0910
  description: Scale test policy 910 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0911
  description: Scale test policy 911 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0912
  description: Scale test policy 912 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0913
  description: Scale test policy 913 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: mark-for-op
    op: terminate
    days: 7
  - type: tag
    key: Compliance
    value: Required
- name: scale-0914
  description: Scale test policy 914 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: global-grants
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:Owner: absent
  - type: no-encryption-statement
  actions:
  - type: auto-tag-user
    tag: Owner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0915
  description: Scale test policy 915 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - tag:CostCenter: absent
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - type: value
    key: PubliclyAccessible
    value: true
  actions:
  - type: tag
    key: SecurityReview
    value: Required
  - type: auto-tag-user
    tag: CreatedBy
  - type: mark-for-op
    op: delete
    days: 14
- name: scale-0916
  description: Scale test policy 916 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - tag:Application: absent
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: tag
    key: RuntimeUpgrade
    value: Required
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0917
  description: Scale test policy 917 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - type: value
    key: SSEDescription.Status
    value: absent
  actions:
  - type: auto-tag-user
    tag: TableOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0918
  description: Scale test policy 918 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - tag:SecurityReviewed: absent
  actions:
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
- name: scale-0919
  description: Scale test policy 919 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0920
  description: Scale test policy 920 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0921
  description: Scale test policy 921 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  - type: value
    key: VolumeType
    value: gp2
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 15
- name: scale-0922
  description: Scale test policy 922 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0923
  description: Scale test policy 923 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  - tag:NetworkTeam: absent
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: tag
    key: FlowLogsRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-0924
  description: Scale test policy 924 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  actions:
  - type: auto-tag-user
    tag: SubnetOwner
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: PublicIPWarning
    value: 'true'
- name: scale-0925
  description: Scale test policy 925 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  actions:
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: LoadBalancerOwner
- name: scale-0926
  description: Scale test policy 926 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  - type: is-not-logging
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: tag
    key: HTTPSRequired
    value: 'true'
- name: scale-0927
  description: Scale test policy 927 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: ASGOwner
- name: scale-0928
  description: Scale test policy 928 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0929
  description: Scale test policy 929 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - type: value
    key: KeyName
    op: glob
    value: test-*
  - tag:Owner: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: KeyOwner
- name: scale-0930
  description: Scale test policy 930 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: LogFileValidationEnabled
    value: false
  - tag:SecurityTeam: absent
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0931
  description: Scale test policy 931 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: value
    key: KeyMetadata.KeyState
    value: Enabled
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0932
  description: Scale test policy 932 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:DataClassification: absent
  - type: cross-account
  - type: value
    key: KeyState
    value: Enabled
  actions:
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
- name: scale-0933
  description: Scale test policy 933 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - type: value
    key: DisplayName
    value: absent
  - type: cross-account
  - tag:Application: absent
  actions:
  - type: tag
    key: AccessReview
    value: Required
  - type: auto-tag-user
    tag: TopicOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0934
  description: Scale test policy 934 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - tag:Owner: absent
  - type: value
    key: QueueArn
    value: present
  actions:
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0935
  description: Scale test policy 935 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: EncryptionType
    value: NONE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0936
  description: Scale test policy 936 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: StreamCreator
- name: scale-0937
  description: Scale test policy 937 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - tag:Owner: absent
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0938
  description: Scale test policy 938 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0939
  description: Scale test policy 939 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - tag:Application: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: DomainOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0940
  description: Scale test policy 940 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  actions:
  - type: auto-tag-user
    tag: FileSystemOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0941
  description: Scale test policy 941 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - type: value
    key: Type
    value: IMPORTED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0942
  description: Scale test policy 942 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - tag:Application: absent
  - type: cross-account
  - type: value
    key: KmsKeyId
    value: absent
  actions:
  - type: tag
    key: KMSRequired
    value: 'true'
  - type: auto-tag-user
    tag: SecretOwner
- name: scale-0943
  description: Scale test policy 943 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - tag:Team: absent
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 180
  - type: auto-tag-user
    tag: RepositoryOwner
- name: scale-0944
  description: Scale test policy 944 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: auto-tag-user
    tag: ProjectOwner
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
- name: scale-0945
  description: Scale test policy 945 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0946
  description: Scale test policy 946 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: set-protection
    state: false
  - type: auto-tag-user
    tag: StackOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0947
  description: Scale test policy 947 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0948
  description: Scale test policy 948 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - type: value
    key: state
    value: ENABLED
  - tag:Owner: absent
  actions:
  - type: auto-tag-user
    tag: ComputeOwner
  - type: mark-for-op
    op: delete
    days: 60
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0949
  description: Scale test policy 949 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: tag
    key: NetworkModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: TaskOwner
- name: scale-0950
  description: Scale test policy 950 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - tag:Team: absent
  - type: value
    key: resourcesVpcConfig.endpointPublicAccess
    value: true
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0951
  description: Scale test policy 951 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: State.Name
    value: running
  - type: ebs
    key: Encrypted
    value: false
  - tag:Environment: absent
  actions:
  - type: mark-for-op
    op: terminate
    days: 7
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
- name: scale-0952
  description: Scale test policy 952 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - type: no-encryption-statement
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: encryption-policy
- name: scale-0953
  description: Scale test policy 953 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  - tag:CostCenter: absent
  actions:
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0954
  description: Scale test policy 954 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: value
    key: Timeout
    value: 300
    op: gt
  - type: value
    key: Runtime
    op: in
    value:
    - python2.7
    - python3.6
  - type: security-group
    key: GroupName
    value: default
  actions:
  - type: mark-for-op
    op: delete
    days: 21
  - type: auto-tag-user
    tag: Creator
- name: scale-0955
  description: Scale test policy 955 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - tag:DataClassification: absent
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TableOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0956
  description: Scale test policy 956 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 22
    Cidr: 0.0.0.0/0
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  actions:
  - type: auto-tag-user
    tag: ModifiedBy
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0957
  description: Scale test policy 957 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: access-key
    key: Status
    value: Active
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: MFARequired
    value: 'true'
- name: scale-0958
  description: Scale test policy 958 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  - type: has-inline-policy
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0959
  description: Scale test policy 959 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - tag:CostCenter: absent
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0960
  description: Scale test policy 960 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: value
    key: Encrypted
    value: false
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0961
  description: Scale test policy 961 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: value
    key: IsDefault
    value: false
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - tag:NetworkTeam: absent
  actions:
  - type: auto-tag-user
    tag: VpcCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0962
  description: Scale test policy 962 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - tag:Purpose: absent
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  actions:
  - type: tag
    key: PublicIPWarning
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0963
  description: Scale test policy 963 for elb resource monitoring and compliance
  resource: elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: requestParameters.loadBalancerName
  filters:
  - tag:Application: absent
  - type: is-not-logging
  actions:
  - type: auto-tag-user
    tag: LoadBalancerOwner
  - type: tag
    key: LoggingRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0964
  description: Scale test policy 964 for app-elb resource monitoring and compliance
  resource: app-elb
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticloadbalancing.amazonaws.com
      event: CreateLoadBalancer
      ids: responseElements.loadBalancers[].loadBalancerArn
  filters:
  - type: value
    key: Scheme
    value: internet-facing
  - type: listener
    key: Protocol
    value: HTTP
  actions:
  - type: auto-tag-user
    tag: ALBCreator
  - type: tag
    key: HTTPSRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 45
- name: scale-0965
  description: Scale test policy 965 for asg resource monitoring and compliance
  resource: asg
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: autoscaling.amazonaws.com
      event: CreateAutoScalingGroup
      ids: requestParameters.autoScalingGroupName
  filters:
  - type: not-encrypted
  - type: value
    key: DesiredCapacity
    value: 10
    op: gt
  actions:
  - type: auto-tag-user
    tag: ASGOwner
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0966
  description: Scale test policy 966 for ami resource monitoring and compliance
  resource: ami
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateImage
      ids: responseElements.imageId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: Public
    value: true
  - tag:Version: absent
  actions:
  - type: auto-tag-user
    tag: ImageCreator
  - type: tag
    key: PublicAMIWarning
    value: 'true'
- name: scale-0967
  description: Scale test policy 967 for key-pair resource monitoring and compliance
  resource: key-pair
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateKeyPair
      ids: responseElements.keyName
  filters:
  - tag:Owner: absent
  - type: value
    key: KeyName
    op: glob
    value: test-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0968
  description: Scale test policy 968 for cloudtrail resource monitoring and compliance
  resource: cloudtrail
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudtrail.amazonaws.com
      event: CreateTrail
      ids: requestParameters.name
  filters:
  - type: value
    key: IsMultiRegionTrail
    value: false
  - type: value
    key: LogFileValidationEnabled
    value: false
  actions:
  - type: tag
    key: ValidationRequired
    value: 'true'
  - type: auto-tag-user
    tag: TrailCreator
- name: scale-0969
  description: Scale test policy 969 for kms resource monitoring and compliance
  resource: kms
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - tag:KeyManager: absent
  - type: grant-count
  actions:
  - type: remove-statements
    statement_ids:
    - CrossAccountAccess
  - type: notify
    to:
    - security@example.com
    subject: New KMS Key Created
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:security-alerts
- name: scale-0970
  description: Scale test policy 970 for kms-key resource monitoring and compliance
  resource: kms-key
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kms.amazonaws.com
      event: CreateKey
      ids: responseElements.keyMetadata.keyId
  filters:
  - type: cross-account
  - tag:DataClassification: absent
  actions:
  - type: post-finding
    severity_label: MEDIUM
    types:
    - Software and Configuration Checks/AWS Security Best Practices
  - type: notify
    to:
    - compliance@example.com
    subject: KMS Key Cross-Account Access
    transport:
      type: sns
      topic: arn:aws:sns:us-east-1:123456789012:compliance-alerts
- name: scale-0971
  description: Scale test policy 971 for sns resource monitoring and compliance
  resource: sns
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sns.amazonaws.com
      event: CreateTopic
      ids: responseElements.topicArn
  filters:
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: TopicOwner
- name: scale-0972
  description: Scale test policy 972 for sqs resource monitoring and compliance
  resource: sqs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: sqs.amazonaws.com
      event: CreateQueue
      ids: responseElements.queueUrl
  filters:
  - type: value
    key: QueueArn
    value: present
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: QueueCreator
  - type: tag
    key: EncryptionReview
    value: Required
- name: scale-0973
  description: Scale test policy 973 for kinesis resource monitoring and compliance
  resource: kinesis
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: kinesis.amazonaws.com
      event: CreateStream
      ids: requestParameters.streamName
  filters:
  - tag:DataOwner: absent
  - type: value
    key: StreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 120
- name: scale-0974
  description: Scale test policy 974 for firehose resource monitoring and compliance
  resource: firehose
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: firehose.amazonaws.com
      event: CreateDeliveryStream
      ids: requestParameters.deliveryStreamName
  filters:
  - tag:Team: absent
  - type: value
    key: DeliveryStreamStatus
    value: ACTIVE
  actions:
  - type: auto-tag-user
    tag: StreamCreator
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0975
  description: Scale test policy 975 for cache-cluster resource monitoring and compliance
  resource: cache-cluster
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticache.amazonaws.com
      event: CreateCacheCluster
      ids: requestParameters.cacheClusterId
  filters:
  - type: value
    key: TransitEncryptionEnabled
    value: false
  - type: value
    key: AtRestEncryptionEnabled
    value: false
  actions:
  - type: auto-tag-user
    tag: CacheOwner
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0976
  description: Scale test policy 976 for redshift resource monitoring and compliance
  resource: redshift
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: redshift.amazonaws.com
      event: CreateCluster
      ids: requestParameters.clusterIdentifier
  filters:
  - type: value
    key: Encrypted
    value: false
  - tag:CostCenter: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: auto-tag-user
    tag: ClusterOwner
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0977
  description: Scale test policy 977 for elasticsearch resource monitoring and compliance
  resource: elasticsearch
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: es.amazonaws.com
      event: CreateElasticsearchDomain
      ids: requestParameters.domainName
  filters:
  - type: value
    key: EncryptionAtRestOptions.Enabled
    value: false
  - type: value
    key: NodeToNodeEncryptionOptions.Enabled
    value: false
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0978
  description: Scale test policy 978 for efs resource monitoring and compliance
  resource: efs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: elasticfilesystem.amazonaws.com
      event: CreateFileSystem
      ids: responseElements.fileSystemId
  filters:
  - tag:Owner: absent
  - type: value
    key: LifeCycleState
    value: available
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: EncryptionRequired
    value: 'true'
- name: scale-0979
  description: Scale test policy 979 for acm-certificate resource monitoring and compliance
  resource: acm-certificate
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: acm.amazonaws.com
      event: RequestCertificate
      ids: responseElements.certificateArn
  filters:
  - tag:Owner: absent
  - type: value
    key: Type
    value: IMPORTED
  actions:
  - type: auto-tag-user
    tag: CertificateRequester
  - type: tag
    key: ExpirationAlert
    value: Required
- name: scale-0980
  description: Scale test policy 980 for secrets-manager resource monitoring and compliance
  resource: secrets-manager
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: secretsmanager.amazonaws.com
      event: CreateSecret
      ids: responseElements.aRN
  filters:
  - type: value
    key: KmsKeyId
    value: absent
  - tag:Application: absent
  - type: cross-account
  actions:
  - type: auto-tag-user
    tag: SecretOwner
  - type: tag
    key: KMSRequired
    value: 'true'
- name: scale-0981
  description: Scale test policy 981 for codecommit resource monitoring and compliance
  resource: codecommit
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codecommit.amazonaws.com
      event: CreateRepository
      ids: responseElements.repositoryMetadata.repositoryId
  filters:
  - type: value
    key: repositoryName
    op: glob
    value: test-*
  - tag:Team: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 180
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0982
  description: Scale test policy 982 for codebuild resource monitoring and compliance
  resource: codebuild
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codebuild.amazonaws.com
      event: CreateProject
      ids: responseElements.project.name
  filters:
  - tag:Owner: absent
  - type: value
    key: environment.privilegedMode
    value: true
  actions:
  - type: tag
    key: PrivilegedModeWarning
    value: 'true'
  - type: auto-tag-user
    tag: ProjectOwner
- name: scale-0983
  description: Scale test policy 983 for codepipeline resource monitoring and compliance
  resource: codepipeline
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: codepipeline.amazonaws.com
      event: CreatePipeline
      ids: responseElements.pipeline.name
  filters:
  - tag:Application: absent
  - type: value
    key: name
    op: glob
    value: dev-*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: PipelineOwner
  - type: mark-for-op
    op: delete
    days: 60
- name: scale-0984
  description: Scale test policy 984 for cfn resource monitoring and compliance
  resource: cfn
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: cloudformation.amazonaws.com
      event: CreateStack
      ids: requestParameters.stackName
  filters:
  - tag:Owner: absent
  - type: value
    key: StackStatus
    value: CREATE_COMPLETE
  actions:
  - type: auto-tag-user
    tag: StackOwner
  - type: set-protection
    state: false
- name: scale-0985
  description: Scale test policy 985 for glue-connection resource monitoring and compliance
  resource: glue-connection
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: glue.amazonaws.com
      event: CreateConnection
      ids: requestParameters.connectionInput.name
  filters:
  - tag:DataTeam: absent
  - type: value
    key: Name
    op: glob
    value: test-*
  actions:
  - type: auto-tag-user
    tag: ConnectionOwner
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0986
  description: Scale test policy 986 for batch-compute resource monitoring and compliance
  resource: batch-compute
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: batch.amazonaws.com
      event: CreateComputeEnvironment
      ids: responseElements.computeEnvironmentName
  filters:
  - tag:Owner: absent
  - type: value
    key: state
    value: ENABLED
  actions:
  - type: mark-for-op
    op: delete
    days: 60
  - type: auto-tag-user
    tag: ComputeOwner
  - type: tag
    key: ReviewRequired
    value: 'true'
- name: scale-0987
  description: Scale test policy 987 for ecs-task-definition resource monitoring and compliance
  resource: ecs-task-definition
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ecs.amazonaws.com
      event: RegisterTaskDefinition
      ids: responseElements.taskDefinition.taskDefinitionArn
  filters:
  - tag:Application: absent
  - type: value
    key: networkMode
    value: host
  actions:
  - type: auto-tag-user
    tag: TaskOwner
  - type: tag
    key: NetworkModeWarning
    value: 'true'
- name: scale-0988
  description: Scale test policy 988 for eks resource monitoring and compliance
  resource: eks
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: eks.amazonaws.com
      event: CreateCluster
      ids: responseElements.cluster.name
  filters:
  - type: value
    key: logging.clusterLogging[0].enabled
    value: false
  - tag:Team: absent
  actions:
  - type: auto-tag-user
    tag: ClusterOwner
  - type: mark-for-op
    op: delete
    days: 90
  - type: tag
    key: LoggingRequired
    value: 'true'
- name: scale-0989
  description: Scale test policy 989 for ec2 resource monitoring and compliance
  resource: ec2
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - RunInstances
  filters:
  - type: value
    key: InstanceType
    value: t2.micro
    op: eq
  - type: value
    key: State.Name
    value: running
  actions:
  - type: auto-tag-user
    tag: CreatorName
  - type: tag
    key: Compliance
    value: Required
  - type: mark-for-op
    op: terminate
    days: 7
- name: scale-0990
  description: Scale test policy 990 for s3 resource monitoring and compliance
  resource: s3
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - CreateBucket
  filters:
  - type: value
    key: Name
    op: glob
    value: test-*
  - tag:Owner: absent
  - type: no-encryption-statement
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: Owner
- name: scale-0991
  description: Scale test policy 991 for rds resource monitoring and compliance
  resource: rds
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: rds.amazonaws.com
      event: CreateDBInstance
      ids: requestParameters.dBInstanceIdentifier
  filters:
  - type: value
    key: StorageEncrypted
    value: false
  - type: value
    key: PubliclyAccessible
    value: true
  - type: value
    key: BackupRetentionPeriod
    value: 0
    op: eq
  actions:
  - type: mark-for-op
    op: delete
    days: 14
  - type: auto-tag-user
    tag: CreatedBy
  - type: tag
    key: SecurityReview
    value: Required
- name: scale-0992
  description: Scale test policy 992 for lambda resource monitoring and compliance
  resource: lambda
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: lambda.amazonaws.com
      event: CreateFunction20150331
      ids: requestParameters.functionName
  filters:
  - type: security-group
    key: GroupName
    value: default
  - type: value
    key: Timeout
    value: 300
    op: gt
  actions:
  - type: auto-tag-user
    tag: Creator
  - type: mark-for-op
    op: delete
    days: 21
- name: scale-0993
  description: Scale test policy 993 for dynamodb-table resource monitoring and compliance
  resource: dynamodb-table
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: dynamodb.amazonaws.com
      event: CreateTable
      ids: requestParameters.tableName
  filters:
  - type: value
    key: SSEDescription.Status
    value: absent
  - type: value
    key: BillingModeSummary.BillingMode
    value: PROVISIONED
  - tag:DataClassification: absent
  actions:
  - type: tag
    key: EncryptionRequired
    value: 'true'
  - type: auto-tag-user
    tag: TableOwner
- name: scale-0994
  description: Scale test policy 994 for security-group resource monitoring and compliance
  resource: security-group
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSecurityGroup
      ids: responseElements.groupId
    - source: ec2.amazonaws.com
      event: AuthorizeSecurityGroupIngress
      ids: requestParameters.groupId
  filters:
  - type: ingress
    IpProtocol: '-1'
    Ports:
    - 3389
    Cidr: 0.0.0.0/0
  - type: value
    key: GroupName
    value: default
    op: ne
  actions:
  - type: mark-for-op
    op: delete
    days: 7
  - type: tag
    key: SecurityIssue
    value: OpenToWorld
- name: scale-0995
  description: Scale test policy 995 for iam-user resource monitoring and compliance
  resource: iam-user
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateUser
      ids: requestParameters.userName
  filters:
  - type: policy
    key: PolicyName
    value: AdministratorAccess
  - type: credential
    key: mfa_active
    value: false
  - type: access-key
    key: Status
    value: Active
  actions:
  - type: tag
    key: MFARequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 90
- name: scale-0996
  description: Scale test policy 996 for iam-role resource monitoring and compliance
  resource: iam-role
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: iam.amazonaws.com
      event: CreateRole
      ids: requestParameters.roleName
  filters:
  - type: value
    key: MaxSessionDuration
    value: 43200
    op: gt
  - type: has-inline-policy
  - type: value
    key: RoleName
    op: regex
    value: ^(test|dev)-.*
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: mark-for-op
    op: delete
    days: 30
- name: scale-0997
  description: Scale test policy 997 for ebs resource monitoring and compliance
  resource: ebs
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVolume
      ids: responseElements.volumeId
  filters:
  - type: value
    key: VolumeType
    value: gp2
  - type: value
    key: Encrypted
    value: false
  - type: value
    key: State
    value: available
  actions:
  - type: mark-for-op
    op: delete
    days: 15
  - type: auto-tag-user
    tag: Creator
- name: scale-0998
  description: Scale test policy 998 for ebs-snapshot resource monitoring and compliance
  resource: ebs-snapshot
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSnapshot
      ids: responseElements.snapshotId
  filters:
  - type: cross-account
  - type: value
    key: Encrypted
    value: false
  actions:
  - type: auto-tag-user
    tag: SnapshotOwner
  - type: mark-for-op
    op: delete
    days: 180
- name: scale-0999
  description: Scale test policy 999 for vpc resource monitoring and compliance
  resource: vpc
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateVpc
      ids: responseElements.vpc.vpcId
  filters:
  - type: dhcp-options
    domain-name-servers: AmazonProvidedDNS
  - type: value
    key: IsDefault
    value: false
  actions:
  - type: tag
    key: ReviewRequired
    value: 'true'
  - type: auto-tag-user
    tag: VpcCreator
- name: scale-1000
  description: Scale test policy 1000 for subnet resource monitoring and compliance
  resource: subnet
  mode:
    type: cloudtrail
    role: arn:aws:iam::{account_id}:role/CloudCustodianLambdaRole
    events:
    - source: ec2.amazonaws.com
      event: CreateSubnet
      ids: responseElements.subnet.subnetId
  filters:
  - type: value
    key: State
    value: available
  - type: value
    key: MapPublicIpOnLaunch
    value: true
  - tag:Purpose: absent
  actions:
  - type: mark-for-op
    op: delete
    days: 30
  - type: auto-tag-user
    tag: SubnetOwner
  - type: tag
    key: PublicIPWarning
    value: 'true'
